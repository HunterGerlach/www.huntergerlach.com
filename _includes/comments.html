<script>
const GH_API_URL = 'https://api.github.com/repos/HunterGerlach/www.huntergerlach.com/issues/{{ page.comments_id }}/comments?per_page=100';

fetch( GH_API_URL, {
	headers: { 'Accept': 'application/vnd.github.html+json' }
})
.then( function( res ) { return res.json(); })
.then( function( comments ) {
	if ( comments.length === 0 ) {
		document.getElementById( 'no-comments-found' ).style.display = 'block';
		return;
	}

	var list = document.getElementById( 'gh-comments-list' );
	comments.forEach( function( c ) {
		list.appendChild( createCommentEl( c ) );
	});
})
.catch( function( err ) { console.error( err ); });

function createCommentEl( c ) {
	var user = document.createElement( 'a' );
	user.setAttribute( 'href', c.user.url.replace( 'api.github.com/users', 'github.com' ) );
	user.classList.add( 'user' );

	var userAvatar = document.createElement( 'img' );
	userAvatar.classList.add( 'avatar' );
	userAvatar.setAttribute( 'src', c.user.avatar_url );
	userAvatar.setAttribute( 'alt', c.user.login + '\'s avatar' );

	user.appendChild( userAvatar );

	var commentLink = document.createElement( 'a' );
	commentLink.setAttribute( 'href', c.html_url );
	commentLink.classList.add( 'comment-url' );
	commentLink.textContent = '#' + c.id + ' - ' + c.created_at;

	var commentContents = document.createElement( 'div' );
	commentContents.classList.add( 'comment-content' );
	commentContents.innerHTML = c.body_html;

	var comment = document.createElement( 'li' );
	comment.setAttribute( 'data-created', c.created_at );
	comment.setAttribute( 'data-author-avatar', c.user.avatar_url );
	comment.setAttribute( 'data-user-url', c.user.url );

	comment.appendChild( user );
	comment.appendChild( commentContents );
	comment.appendChild( commentLink );

	return comment;
}
</script>

<hr>

<div class="github-comments">
	<h2>Comments</h2>
	<ul id="gh-comments-list"></ul>
	<p id="no-comments-found">No comments found for this article.</p>
	<p id="leave-a-comment">Join the discussion for this article on <a href="https://github.com/HunterGerlach/www.huntergerlach.com/issues/{{ page.comments_id }}">this ticket</a>. Comments appear after refreshing the page.</p>
</div>
